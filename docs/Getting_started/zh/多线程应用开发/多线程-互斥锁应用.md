# 多线程-互斥锁应用
## 什么是多线程-互斥锁

本文介绍如何使用QuecPython的多线程-互斥锁功能，互斥锁可以资源不会冲突，通常用于保护硬件接口通信的完整性，如SPI、I2C通信命令要严格的指令顺序才能正确通信。

## 怎么使用多线程-互斥锁

### 软件应用

使用QuecPython开发的模组，调用\_thread模块中的_thread.allocate_lock()可以创建互斥锁，具体参数参考[_thread功能的API介绍文档](/../../API_reference/zh/QuecPython标准库/_thread-多线程.html)，互斥锁必须成对使用。

```python
import utime
import _thread

def thread_1():
    while True:
        for i in range(3):
            lock.acquire()
            print('thread_1', i)
            utime.sleep_ms(2000)
            lock.release()

def thread_2():
    while True:
        for i in range(3):
            lock.acquire()
            print('thread_2', i)
            utime.sleep_ms(2000)
            lock.release()

lock = _thread.allocate_lock()
_thread.start_new_thread(thread_1, ())
_thread.start_new_thread(thread_2, ())
```
注意：线程里调用lock.acquire后进入阻塞并切换上下文，直到系统获得锁立即往下执行，lock.release()释放锁，有等待锁的线程会立即执行。


## _thread功能测试

使用QPYcom工具执行代码，可以看出两条线程在打印信息，值得注意的是执行到utime.sleep_ms(2000)的时候并没有切换线程，是因为锁还没释放。

![](../media\多线程应用开发/_thread-allocate_lock.png)

